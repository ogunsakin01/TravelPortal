$(window).on("load",function(){var t=d3.dispatch("load","statechange"),a=d3.select("#disptach-events"),n=["Under 5 Years","5 to 13 Years","14 to 17 Years","18 to 24 Years","25 to 44 Years","45 to 64 Years","65 Years and Over"];d3.csv("../../../app-assets/data/d3/pie/dispatch-events.csv",function(t){return t.total=d3.sum(n,function(a){return t[a]=+t[a]}),t},function(a,n){if(a)throw a;var e=d3.map();n.forEach(function(t){e.set(t.id,t)}),t.load(e),t.statechange(e.get("CA"))}),t.on("load.menu",function(n){var e=a.append("div").append("select").on("change",function(){t.statechange(n.get(this.value))});e.selectAll("option").data(n.values()).enter().append("option").attr("value",function(t){return t.id}).text(function(t){return t.id}),t.on("statechange.menu",function(t){e.property("value",t.id)})}),t.on("load.bar",function(n){var e=20,r=20,i=30,o=40,d=80-o-r,s=460-e-i,c=d3.scale.linear().domain([0,d3.max(n.values(),function(t){return t.total})]).rangeRound([s,0]).nice(),l=d3.svg.axis().scale(c).orient("left").tickFormat(d3.format(".2s")),u=a.append("svg").attr("width",d+o+r).attr("height",s+e+i).append("g").attr("transform","translate("+o+","+e+")");u.append("g").attr("class","y axis").call(l);var p=u.append("rect").attr("x",4).attr("width",d-4).attr("y",s).attr("height",0).style("fill","#aaa");t.on("statechange.bar",function(t){p.transition().attr("y",c(t.total)).attr("height",c(0)-c(t.total))})}),t.on("load.pie",function(e){var r=a.node().getBoundingClientRect().width-100,i=Math.min(r,460)/2,o=d3.scale.ordinal().domain(n).range(["#99B898","#FECEA8","#FF847C","#E84A5F","#F8B195","#F67280","#C06C84"]),d=d3.svg.arc().outerRadius(i-10).innerRadius(i-70),s=d3.layout.pie().sort(null),c=a.append("svg").attr("width",r).attr("height",460).append("g").attr("transform","translate("+r/2+",230)").selectAll("path").data(n).enter().append("path").style("fill",o).each(function(){this._current={startAngle:0,endAngle:0}});t.on("statechange.pie",function(t){c.data(s.value(function(a){return t[a]})(n)).transition().attrTween("d",function(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return d(a(t))}})})})});
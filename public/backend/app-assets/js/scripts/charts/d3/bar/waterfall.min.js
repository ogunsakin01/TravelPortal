$(window).on("load",function(){var t=d3.select("#waterfall"),a={top:20,right:20,bottom:30,left:50},n=t.node().getBoundingClientRect().width-a.left-a.right,e=500-a.top-a.bottom;padding=.3;var r=d3.scale.ordinal().rangeRoundBands([0,n],padding),d=d3.scale.linear().range([e,0]),l=d3.svg.axis().scale(r).orient("bottom"),i=d3.svg.axis().scale(d).orient("left").tickFormat(function(t){return c(t)}),o=t.append("svg"),s=o.attr("width",n+a.left+a.right).attr("height",e+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");function c(t){var a=t=Math.round(t);return Math.abs(t)>1e3&&(a=Math.round(t/1e3)+"K"),"$"+a}function u(){n=t.node().getBoundingClientRect().width-a.left-a.right,o.attr("width",n+a.left+a.right),s.attr("width",n+a.left+a.right),r.rangeRoundBands([0,n],padding),s.selectAll(".d3-xaxis").call(l),s.selectAll(".d3-bar").attr("transform",function(t){return"translate("+r(t.name)+",0)"}),s.selectAll(".d3-bar rect").attr("width",r.rangeBand()),s.selectAll(".d3-bar text").attr("x",r.rangeBand()/2),s.selectAll(".d3-connector").attr("x1",r.rangeBand()+5).attr("x2",r.rangeBand()/(1-padding)-5)}d3.csv("../../../app-assets/data/d3/bar/waterfall.csv",function(t){return t.value=+t.value,t},function(t,a){if(t)throw t;for(var n=0,o=0;o<a.length;o++)a[o].start=n,n+=a[o].value,a[o].end=n,a[o].class=a[o].value>=0?"positive":"negative";a.push({name:"Total",end:n,start:0,class:"total"}),r.domain(a.map(function(t){return t.name})),d.domain([0,d3.max(a,function(t){return t.end})]),s.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+e+")").call(l),s.append("g").attr("class","d3-axis d3-yaxis").call(i);var u=s.selectAll(".d3-bar").data(a).enter().append("g").attr("class",function(t){return"d3-bar "+t.class}).attr("transform",function(t){return"translate("+r(t.name)+",0)"});u.append("rect").attr("y",function(t){return d(Math.max(t.start,t.end))}).attr("height",function(t){return Math.abs(d(t.start)-d(t.end))}).attr("width",r.rangeBand()),u.append("text").attr("x",r.rangeBand()/2).attr("y",function(t){return d(t.end)+5}).attr("dy",function(t){return("negative"==t.class?"-":"")+".75em"}).text(function(t){return c(t.end-t.start)}),u.filter(function(t){return"total"!=t.class}).append("line").attr("class","d3-connector").attr("x1",r.rangeBand()+5).attr("y1",function(t){return d(t.end)}).attr("x2",r.rangeBand()/(1-padding)-5).attr("y2",function(t){return d(t.end)})}),$(window).on("resize",u),$(".menu-toggle").on("click",u)});
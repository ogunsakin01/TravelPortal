$(window).on("load",function(){var t=d3.select("#stacked-to-grouped"),n={top:20,right:20,bottom:30,left:50},r=t.node().getBoundingClientRect().width-n.left-n.right,a=500-n.top-n.bottom,e=4,i=d3.layout.stack()(d3.range(e).map(function(){return function(t,n){function r(n){for(var r=1/(.1+Math.random()),a=2*Math.random()-.5,e=10/(.1+Math.random()),i=0;i<t;i++){var o=(i/t-a)*e;n[i]+=r*Math.exp(-o*o)}}var a,e=[];for(a=0;a<t;++a)e[a]=n+n*Math.random();for(a=0;a<5;++a)r(e);return e.map(function(t,n){return{x:n,y:Math.max(0,t)}})}(58,.1)})),o=d3.max(i,function(t){return d3.max(t,function(t){return t.y})}),d=d3.max(i,function(t){return d3.max(t,function(t){return t.y0+t.y})}),u=d3.scale.ordinal().domain(d3.range(58)).rangeRoundBands([0,r],.08),c=d3.scale.linear().domain([0,d]).range([a,0]),l=d3.scale.linear().domain([0,e-1]).range(["#FECEA8","#E84A5F"]),f=d3.svg.axis().scale(u).tickSize(0).tickPadding(6).orient("bottom"),s=t.append("svg"),g=s.attr("width",r+n.left+n.right).attr("height",a+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),h=g.selectAll(".layer").data(i).enter().append("g").attr("class","layer").style("fill",function(t,n){return l(n)}).selectAll(".d3-bar").data(function(t){return t}).enter().append("rect").attr("class","d3-bar").attr("x",function(t){return u(t.x)}).attr("y",a).attr("width",u.rangeBand()).attr("height",0);h.transition().delay(function(t,n){return 10*n}).attr("y",function(t){return c(t.y0+t.y)}).attr("height",function(t){return c(t.y0)-c(t.y0+t.y)}),g.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+a+")").call(f),d3.selectAll("input").on("change",m);var y=setTimeout(function(){d3.select('input[value="grouped"]').property("checked",!0).each(m)},2e3);function m(){clearTimeout(y),"grouped"===this.value?(c.domain([0,o]),h.transition().duration(500).delay(function(t,n){return 10*n}).attr("x",function(t,n,r){return u(t.x)+u.rangeBand()/e*r}).attr("width",u.rangeBand()/e).transition().attr("y",function(t){return c(t.y)}).attr("height",function(t){return a-c(t.y)})):(c.domain([0,d]),h.transition().duration(500).delay(function(t,n){return 10*n}).attr("y",function(t){return c(t.y0+t.y)}).attr("height",function(t){return c(t.y0)-c(t.y0+t.y)}).transition().attr("x",function(t){return u(t.x)}).attr("width",u.rangeBand()))}function p(){r=t.node().getBoundingClientRect().width-n.left-n.right,s.attr("width",r+n.left+n.right),g.attr("width",r+n.left+n.right),u.rangeRoundBands([0,r],.08),g.selectAll(".d3-xaxis").call(f),g.selectAll(".d3-bar").attr("x",function(t){return u(t.x)})}$(window).on("resize",p),$(".menu-toggle").on("click",p)});